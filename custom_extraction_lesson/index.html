<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Isaac Tamblyn, Mark Crowley, Amanuel Dawit">
  <link rel="canonical" href="http://docs.ChemGymRL.org/custom_extraction_lesson/">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Custom Extraction Lesson - RLChemistry Documentation</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Custom Extraction Lesson";
    var mkdocs_page_input_path = "custom_extraction_lesson.md";
    var mkdocs_page_url = "/custom_extraction_lesson/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> RLChemistry Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Getting Started</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../WhatIsChemGymRL/">What is ChemGymRL?</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Installation/">Installation</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../UsingCmdLine/">Using Command Line</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../jenkins/">Using Jenkins</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Directory/">Directory</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../QuickStart/">Quick Start</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">User Manual</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../About/">About</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../input/">Input</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Output/">Output</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../VisualizingOutput/">Visualizing Output</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Developers/">Developers</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Glossary/">Glossary</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Troubleshooting/">Troubleshooting</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../RLalgo/">Examples of RL algoritm and Results</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Tutorials</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../lesson_1_react/">Reaction Bench Tutorial</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../custom_reaction_lesson/">Custom Reaction Lesson</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../vessel_lesson/">Vessel Lesson</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../lesson_1_extract/">Extraction Bench Tutorial</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Custom Extraction Lesson</a>
    <ul class="current">
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Tutorial3/">Distillation Bench Tutorial</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../Contact/">Contact Us</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../License/">Citation and Licence</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">RLChemistry Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Tutorials &raquo;</li>
        
      
    
    <li>Custom Extraction Lesson</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/chemgymrl/Documentation/edit/master/docs/custom_extraction_lesson.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h2 id="building-a-custom-extraction-file">Building A Custom Extraction File</h2>
<p>For this tutorial we will be showing you how to create a custom extraction environment to train an RL agent on!</p>
<p>In this case we will be doing the extraction of Methyl Red from a solution of hydrochloric acid into Ethyl Acetate.
The procedure and set up of this reaction can be found at this
<a href="https://chem.libretexts.org/Bookshelves/Organic_Chemistry/Book%3A_Organic_Chemistry_Lab_Techniques_(Nichols)/04%3A_Extraction/4.06%3A_Step-by-Step_Procedures_For_Extractions">link</a>.
Now let's get started.</p>
<p><img alt="extraction environment" src="" /></p>
<p>The extraction bench is one of the more complicated environments to build since there are a lot more actions to take in
the environment and as a result a lot more to set up. As a result we are starting with a very simple, single extraction
but after having implemented this it should be obvious how to extend this to larger more complicated extractions.</p>
<p>Typically, in a new reaction or extraction it will be important to define the new materials in 
<code>chemistrylab/chem_algorithms/material.py</code> but for this case we have implemented the 2 new materials
(methyl red and ethyl acetate). Go into the material file and look at the materials and familiarize yourself with the
properties of each material. In your own project after creating the new materials it is then time to create the
extraction environment space, and the actions that can be performed in that extraction. For a simple single extraction
we can use a prebuilt environment in this case <code>chemistrylab/extract_bench/extraction_0.py</code>. Please take a read through
the file and try to understand how actions are performed and how we set up vessels. Now we will create a new extraction
bench file in the following directory <code>chemistrylab/extract_bench</code>, let's create a new file called <code>methyl_red.py</code>.
In this new file we are going to use the following code:</p>
<pre><code class="language-python">import numpy as np
import gym
import gym.spaces
from chemistrylab.extract_bench.extract_bench_v1_engine import ExtractBenchEnv
from chemistrylab.chem_algorithms import material, util, vessel

# initialize extraction vessel
extraction_vessel = vessel.Vessel(label='extraction_vessel',
                                  )

# initialize materials
H2O = material.H2O
HCl = material.HCl
H = material.H
Cl = material.Cl
MethylRed = material.MethylRed
EthylAcetate = material.EthylAcetate

# material_dict
# The material dict is the data-structure we use to describe the materials that will be in our vessel
# found inside of our vessel, in this case it is of the form
# {material_name: [material_class, quantity, unit]}
# you don't need to specify a unit but if you don't we assume you are using mols
material_dict = {H2O().get_name(): [H2O, 27.7],
                 H().get_name(): [H, 2.5e-4],
                 Cl().get_name(): [Cl, 2.5e-4],
                 MethylRed().get_name(): [MethylRed, 9.28e-4],
                 }
# solute_dict
# the solute dict describes how different materials are dissolved in others
# {solute_name: {solvent_name: [quantity, unit]}}
# you don't need to specify a unit but if you don't we assume you are using mols
solute_dict = {H().get_name(): {H2O().get_name(): [27.7, 'mol']},
               Cl().get_name(): {H2O().get_name(): [27.7, 'mol']},
               MethylRed().get_name(): {H2O().get_name(): [500, 'ml']},
               }

# this function checks if we have poured too many materials in our vessel and if we have it returns a vessel
# with the appropriate amount of materials lost
material_dict, solute_dict, _ = util.check_overflow(material_dict=material_dict,
                                                    solute_dict=solute_dict,
                                                    v_max=extraction_vessel.get_max_volume(),
                                                    )

# Here we push events that update the material dictionary, solute dictionary and then mix all of the materials together
event_1 = ['update material dict', material_dict]
event_2 = ['update solute dict', solute_dict]
event_3 = ['fully mix']

extraction_vessel.push_event_to_queue(events=None, feedback=[event_1], dt=0)
extraction_vessel.push_event_to_queue(events=None, feedback=[event_2], dt=0)
extraction_vessel.push_event_to_queue(events=None, feedback=[event_3], dt=0)

# Here is our initialization of the extraction bench environment
# Make sure to give it a unique name and specify the correct extraction bench that we have defined above
# in this case our extractor is EthylAcetate because it is less polar than water, this in turn allows us
# to extract the desired material methyl red
class ExtractWorld_MethylRed(ExtractBenchEnv):
    def __init__(self):
        super(ExtractWorld_MethylRed, self).__init__(
            extraction='extraction_0',
            extraction_vessel=extraction_vessel,
            target_material='methyl red',
            extractor=EthylAcetate
        )

</code></pre>
<p>Now we just have to add some code to allow the new environment to be recognized by gym. In the following file
<code>chemistrylab/__init__.py</code> we will add the following line of code:</p>
<pre><code class="language-python">register(
    id='MethylRed_Extract-v1',
    entry_point='chemistrylab.extract_bench.methyl_red:ExtractWorld_MethylRed',
    max_episode_steps=100
)
</code></pre>
<p>Now we're done! To test that these changes have worked, simply run the following code:</p>
<pre><code class="language-python">from gym import envs

all_envs = envs.registry.all()
env_ids = [env_spec.id for env_spec in all_envs if 'Extract' in env_spec.id]
print(env_ids)
</code></pre>
<p>You should see in the output <code>MethylRed_Extract-v1</code></p>
<pre><code># ['WurtzExtract-v1', 'Oil_Water_Extract-v1', 'MethylRed_Extract-v1', 'MethylRed_Extract-v2']
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../Tutorial3/" class="btn btn-neutral float-right" title="Distillation Bench Tutorial">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../lesson_1_extract/" class="btn btn-neutral" title="Extraction Bench Tutorial"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/chemgymrl/Documentation/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../lesson_1_extract/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../Tutorial3/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
